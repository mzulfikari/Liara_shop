{% load static %}
{% load jalali_tags %}

<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>محصولات</title>

  <link rel="stylesheet" href="{% static 'css/output.css' %}" />
  <link rel="stylesheet" href="{% static 'css/font.css' %}">

  <!-- PRODUCT SLIDER CSS -->
  <link rel="stylesheet" href="{% static 'css/swiper-bundle.min.css' %}" />
  <link rel="stylesheet" href="{% static 'css/style.product.slider.css' %}" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
  <style>
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .swal2-styled {
      color: black !important;
    }
  </style>

  <!-- TOAST -->
  <link rel="stylesheet" href="{% static '' %}css/toastify.css">
  <style>
    .btn-login-prompt {
      display: inline-block;
      background: linear-gradient(135deg, #d10000, #ff4b4b);
      color: #fff;
      padding: 10px 22px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      box-shadow: 0 4px 8px rgba(209, 0, 0, 0.2);
      transition: all 0.3s ease;
      text-align: center;
      text-decoration: none;
      white-space: nowrap;
    }

    .btn-login-prompt:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(209, 0, 0, 0.3);
    }

    @media (max-width: 768px) {
      .btn-login-prompt {
        font-size: 13px;
        padding: 9px 18px;
      }
    }

    @media (max-width: 480px) {
      .btn-login-prompt {
        display: block;
        width: 100%;
        text-align: center;
        font-size: 12px;
        padding: 8px 14px;
      }
    }
  </style>

</head>

<body class="bg-gray-50">
  <!-- NAVBAR -->
  <div>
    <!-- TOP -->
    {% include 'includes/head.html' %}
    <!-- OPACITY SCREEN FOR SEARCH INPUT FOCUS -->
    <div class="absolute w-full h-screen bg-gray-200 opacity-40 z-40 hidden" id="opacitiScreen" onclick="closeScreen()">
    </div>
  </div>
  <!-- MAIN -->
  <div class="max-w-[1440px] mx-auto px-3">
    <div class="flex gap-x-2 px-10 mt-5 md:mt-10">
      <div>
        <a href="{% url 'Product:Product_view' %}" class="hover:text-red-500 transition text-sm opacity-70">خانه</a>
      </div>
      <div class="opacity-70">/</div>
      <div>
        <a href="" class="hover:text-red-500 transition text-sm opacity-70">کالای دیجیتال</a>
      </div>
      <div class="opacity-70">/</div>
      <div>
        <a href="" class="hover:text-red-500 transition text-sm opacity-70">موبایل</a>
      </div>
    </div>
    <div class="bg-white shadow-xl my-5 md:my-10 rounded-xl md:rounded-2xl p-3 md:p-5">
      <div class="p-3 w-11/12 mx-auto rounded-2xl">
        <div class="lg:flex">
          <div class="w-full lg:w-1/3">
            <div>
              <span class="flex items-center pr-20 pb-2">
                <svg onclick="showAlertAddToFavorit()"
                  class="h-7 w-7 text-red-500 hover:text-red-600 fill-current transition cursor-pointer inline"
                  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                  <path
                    d="M12.76 3.76a6 6 0 0 1 8.48 8.48l-8.53 8.54a1 1 0 0 1-1.42 0l-8.53-8.54a6 6 0 0 1 8.48-8.48l.76.75.76-.75zm7.07 7.07a4 4 0 1 0-5.66-5.66l-1.46 1.47a1 1 0 0 1-1.42 0L9.83 5.17a4 4 0 1 0-5.66 5.66L12 18.66l7.83-7.83z">
                  </path>
                </svg>
              </span>
            </div>
            <div>
              <div class="max-w-[300px] mx-auto">

                {% if products.image %}
                <img class="mySlides rounded-xl md:rounded-3xl" src="{{ products.image.url }}" style="width:100%">
                {% else %}
                <img class="mySlides rounded-xl md:rounded-3xl" src="{% static 'image/logo.png' %}" style="width:100%">
                {% endif %}

                {% if products.image_subset_1 or products.image_subset_2 or products.image_subset_3 %}
                {% if products.image_subset_1 %}
                <img class="mySlides rounded-xl md:rounded-3xl" src="{{ products.image_subset_1.url }}"
                  style="width:100%;display:none">
                {% endif %}

                {% if products.image_subset_2 %}
                <img class="mySlides rounded-xl md:rounded-3xl" src="{{ products.image_subset_2.url }}"
                  style="width:100%;display:none">
                {% endif %}

                {% if products.image_subset_3 %}
                <img class="mySlides rounded-xl md:rounded-3xl" src="{{ products.image_subset_3.url }}"
                  style="width:100%;display:none">
                {% endif %}

                {% else %}
                <img class="mySlides rounded-xl md:rounded-3xl" src="{% static 'image/logo.png' %}"
                  style="width:100%;display:none">
                {% endif %}

              </div>
              <div class="flex justify-around gap-x-4 mt-3">
                <div class="max-w-[80px]">

                  {% if products.image %}
                  <img class="rounded-xl opacity-70 hover:opacity-100 transition" src="{{ products.image.url }}"
                    onclick="currentDiv(1)">
                  {% else %}
                  <img class="rounded-xl opacity-70 hover:opacity-100 transition" src="{% static 'image/logo.png' %}"
                    onclick="currentDiv(1)">
                  {% endif %}

                </div>
                <div class="max-w-[80px]">
                  {% if products.image_subset_1 or products.image_subset_2 or products.image_subset_3 %}
                  {% if products.image_subset_1 %}
                  <img class="rounded-xl opacity-70 hover:opacity-100 transition"
                    src="{{ products.image_subset_1.url }}" onclick="currentDiv(2)">
                  {% endif %}

                </div>
                <div class="max-w-[80px]">

                  {% if products.image_subset_2 %}
                  <img class="rounded-xl opacity-70 hover:opacity-100 transition"
                    src="{{ products.image_subset_2.url }}" onclick="currentDiv(3)">
                  {% endif %}

                </div>
                <div class="max-w-[80px]">

                  {% if products.image_subset_3 %}
                  <img class="rounded-xl opacity-70 hover:opacity-100 transition"
                    src="{{ products.image_subset_3.url }}" onclick="currentDiv(4)">
                  {% endif %}
                  {% endif %}

                </div>
              </div>
            </div>
          </div>
          <div class="w-full lg:w-2/3 mt-5 md:mt-0">
            <div class="opacity-80 text-lg font-semibold">
              {{ products.title }}
            </div>
            <div class="opacity-50 text-xs mt-2 mb-4">
              {{ products.hover_title }}
            </div>

            <div class="md:flex sm:pr-7">
              <div class="md:w-2/3">
                <div>
                  <div class="mt-4 mb-2 opacity-80 text-sm font-semibold">
                    ویژگی های محصول:
                  </div>
                  {% for info in object.information.all|slice:":3" %}
                  <div class="flex flex-col gap-y-2 text-xs">
                    <div class=" flex items-center">
                      <h3 class="opacity-60 ml-1">
                        {{ info.Feature_title }}
                      </h3>
                      <div class="opacity-80">
                        <div class="text-right">
                          {{ info.Featur}}
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                </div>
                <form action="{% url 'Cart:Cart_datail' %}" method="post">
                  {% csrf_token %}
                  <div class="flex items-center">
                    <div class="opacity-70 text-sm mb-1">
                      رنگ بندی:
                    </div>
                    <div class="flex flex-wrap">
                      <div class="flex items-center gap-x-2">
                        <div class="flex w-max">
                          <div class="inline-flex items-center">

                          </div>
                          <div class="inline-flex items-center">
                            {% for color in products.colors.all %}
                            <label class="relative flex cursor-pointer items-center rounded-full p-3"
                              for="{{ color.id }}">
                              <input id="{{ color.id }}" name="color" type="radio"
                                class="before:content[''] peer relative h-7 w-7 cursor-pointer appearance-none rounded-full border border-blue-gray-200 bg-blue-500 text-blue-500 transition-all before:absolute before:top-2/4 before:left-2/4 before:block before:h-12 before:w-12 before:-translate-y-2/4 before:-translate-x-2/4 before:rounded-full before:bg-blue-gray-500 before:opacity-0 before:transition-opacity checked:border-blue-500 checked:before:bg-blue-500 hover:before:opacity-10" />
                              <div
                                class="pointer-events-none absolute top-2/4 left-2/4 -translate-y-2/4 -translate-x-2/4 text-blue-500 opacity-0 transition-opacity peer-checked:opacity-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" viewBox="0 0 16 16"
                                  fill="{{ color.color_code }}">
                                  <circle data-name="ellipse" cx="8" cy="8" r="8"></circle>
                                </svg>
                              </div>
                            </label>
                            {% endfor %}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
              </div>
              <div class="md:w-2/5 mt-5 md:mt-0">
                <div class="pb-5 rounded-2xl shadow-xl border">
                  <div class="flex justify-between px-3 py-5">
                    <div class="text-right opacity-80 text-sm flex flex-col gap-y-6">
                      <div>
                        رنگ بندی:
                      </div>
                      <div>
                        موجودیت :
                      </div>
                      <div>
                        قیمت:
                      </div>
                      <div>
                        تعداد:
                      </div>
                    </div>
                    <div class="text-left opacity-70 text-sm flex flex-col gap-y-6">

                      <div>
                        6 ماهه تمام
                      </div>
                      {% if  products.stock_count %}
                      <div>
                        {{ products.stock_count }}
                      </div>
                      {% else %}
                      <div class="flex text-red-500">
                        ناموجود
                      </div>
                      {% endif %}
                      <div class="flex text-red-500">
                        <div>
                          {{ products.price }}
                        </div>
                        <div>
                          تومان
                        </div>
                      </div>

                      <div class="flex text-sm sm:text-sm items-center justify-center lg:justify-start">
                        <div class="flex items-center justify-center select-none">
                          <div class="quantity flex items-center">
                            <input class="w-12 h-7 mx-2 text-center border focus:outline-none rounded-lg" type="number"
                              min="1" max="25" step="1" value="1" readonly>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <span class="flex justify-center items-center opacity-90">
                    {% if  products.stock_count %}
                    <button type="submit"
                      class="px-7 py-2 text-center text-white bg-red-500 align-middle border-0 rounded-lg shadow-md text-sm">افزودن
                      به سبد خرید </button>
                  </span>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
        </form>

        <!-- TABS -->
        <div class="mx-auto">
          <div class="border-b border-gray-200 mb-4">
            <ul class="flex justify-center flex-wrap -mb-px text-center" id="myTab" data-tabs-toggle="#myTabContent"
              role="tablist">
              <li class="mr-2" role="presentation">
                <button
                  class="inline-block text-gray-500 hover:text-gray-600 hover:border-gray-300 rounded-t-lg py-4 px-4 text-sm font-medium text-center border-transparent border-b-2"
                  id="about-tab" data-tabs-target="#about" type="button" role="tab" aria-controls="about"
                  aria-selected="false">درباره محصول</button>
              </li>
              <li class="mr-2" role="presentation">
                <button
                  class="inline-block text-gray-500 hover:text-gray-600 hover:border-gray-300 rounded-t-lg py-4 px-4 text-sm font-medium text-center border-transparent border-b-2 active"
                  id="test-tab" data-tabs-target="#test" type="button" role="tab" aria-controls="test"
                  aria-selected="true">بررسی تخصصی</button>
              </li>
              <li class="mr-2" role="presentation">
                <button
                  class="inline-block text-gray-500 hover:text-gray-600 hover:border-gray-300 rounded-t-lg py-4 px-4 text-sm font-medium text-center border-transparent border-b-2"
                  id="details-tab" data-tabs-target="#details" type="button" role="tab" aria-controls="details"
                  aria-selected="false">مشخصات</button>
              </li>
              <li role="presentation">
                <button
                  class="inline-block text-gray-500 hover:text-gray-600 hover:border-gray-300 rounded-t-lg py-4 px-4 text-sm font-medium text-center border-transparent border-b-2"
                  id="commentsBuy-tab" data-tabs-target="#commentsBuy" type="button" role="tab"
                  aria-controls="commentsBuy" aria-selected="false"> پرسش ها</button>
              </li>

            </ul>
          </div>
          <div id="myTabContent">
            <div class="bg-gray-50 p-4 rounded-xl hidden" id="about" role="tabpanel" aria-labelledby="about-tab">
              <span class="border-b-red-500 border-b">
                معرفی محصول
              </span>
              <p class="text-gray-500 text-sm leading-7 mt-3">
                {{ products.caption }}
              </p>
            </div>

            <div class="bg-gray-50 p-4 rounded-xl" id="test" role="tabpanel" aria-labelledby="test-tab">
              <div class="flex flex-col items-start gap-y-4">
                <span class="border-b-red-500 border-b">
                  بررسی تخصصی محصول
                </span>
                <span class="border-b-red-500 border-b text-sm">
                  طراحی کاربر پسند
                </span>
              </div>
              <div class="md:flex gap-3">
                <p class="text-gray-500 text-sm leading-7 mt-3">
                  آیفون SE 2020 به عنوان جدید‌ترین گوشی هوشمند مقرون ‌به ‌صرفه این شرکت معرفی شده بود که در قسمت‌های
                  کناری برخلاف پرچمداران خانواده آیفون 11 که فریمی منحنی شکل داشتند، فریم تخت داشت. این طراحی یادآور
                  طراحی‌های قدیمی‌ این شرکت بود و حس نوستالژی را به کاربر منتقل می‌کرد. برای اولین بار، از این طراحی در
                  گوشی‌های هوشمند خانواده آیفون 12 نیز استفاده شد که استقبال بی نظیر کاربران را به همراه داشت. همین امر
                  سبب شد تا پرچمداران خانواده آیفون 13 نیز از این طراحی نوستالژی و جذاب بهره ببرند. در نگاه اولیه شاید
                  طراحی در نظر گرفته شده برای آیفون 13 پرو تفاوت چندانی با آیفون 12 پرو نداشته باشد، اما اپل توانست با
                  تغییرات هرچند اندک و تنوع رنگی جدید، ظاهری به مراتب جذاب‌تر و همه پسندتر به آن بدهد.
                </p>
                <img class="max-w-[320px] w-full mx-auto rounded-3xl" src="{% static 'image/product/good.jpg' %}"
                  alt="">
              </div>
            </div>

            <div class="bg-gray-50 p-4 rounded-xl hidden" id="details" role="tabpanel" aria-labelledby="details-tab">
              <span class="border-b-red-500 border-b">
                ویژگی های کلی
              </span>

              <div class="text-gray-500 text-sm grid grid-cols-1 gap-x-3 md:grid-cols-2">
                {% for info in object.information.all %}
                <div class="flex items-center justify-between bg-gray-100 p-3 w-full my-3 mx-auto rounded-xl">
                  <div class="text-xs opacity-80">
                    {{ info.Feature_title }}
                  </div>
                  <div class="text-xs opacity-70">
                    {{ info.Featur}}
                  </div>
                </div>
                {% endfor %}

              </div>
            </div>
            <div class="bg-gray-50 p-4 rounded-xl hidden" id="commentsBuy" role="tabpanel"
              aria-labelledby="commentsBuy-tab">
              <span class="border-b-red-500 border-b">
                پرسش های محصول
              </span>
              <p class="text-gray-500 text-sm">
                <div class="flex flex-col py-4 px-4 mx-auto my-6 max-w-7xl rounded-2xl bg-white">
                  <!-- UO COMMENTS -->
                  <div>

                    <div class="pr-5 opacity-70 text-xs">{{ products.comments.count }} نظر</div>
                  </div>


                 
                  <!-- COMMENT -->
                  <div class="bg-gray-50 rounded-xl px-5 py-3 my-2">

                    {% for comment in products.comments.all %}
                        {% if comment.status == 'It was confirmed' %}

                    <div class="flex items-center">
                      <div>
                          {% if comment.user.image %}
                             <img class="w-10" src="{{ comment.user.image.url }}" alt="">
                               {% else %}
                                  <img class="border rounded-full w-24" src="{% static 'image/team-2.jpg' %}" alt="">
                          {% endif %}
                      </div>

                      <div class="text-sm opacity-60 pr-1">
                        نوشته شده توسط {% if comment.user.first_name and comment.user.last_name %}
                        {{ comment.user.first_name }}
                        {{ comment.user.last_name }}
                        {% else %}
                        {{ comment.user}}
                        {% endif %} {{ comment.created_at|to_jalali:'%Y/%m/%d' }}
                      </div>
                    </div>
                    <div class="opacity-60 text-sm py-3">
                      {{ comment.body }}
                    </div>
                    <button
                      class="mr-auto px-2 sm:px-4 py-2 opacity-80 md:w-auto text-xs sm:text-sm xl:text-base flex justify-center items-center">
                      پاسخ
                    </button>
                  </div>
                
                  <!-- RESPONSE -->
                  <div class="bg-gray-100 rounded-xl pl-2 pr-5 sm:pr-8 py-3">
                    <div class="flex items-center">
                      <div>
                        <img class="w-10" src="{% static 'image/userNotImage.png' %}" alt="">
                      </div>
                      <div class="text-sm opacity-60 pr-1">
                        پاسخ داده شده توسط امیررضا کریمی
                      </div>
                    </div>
                    <div class="opacity-60 text-sm py-3">
                      لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ و با استفاده از طراحامه و مجله در
                      ستون
                      و سطرآنچنان که لازم است.
                    </div>
                    <div>
                      <button
                        class="mr-auto px-2 sm:px-4 py-2 opacity-80 md:w-auto text-xs sm:text-sm xl:text-base flex justify-center items-center">
                        پاسخ
                      </button>
                    </div>
                  {% endif %}
                     {% endfor %}
                  </div>
                </div>

                {% if  request.user.is_authenticated %}
                <!-- BOX SENT COMMENT -->
                <form id="comment" class="comment" method="POST">
                  {% csrf_token %}
                  <div class="mb-4">
                    <label for="mailTicket" class="inline-block mb-2 ml-1 font-semibold text-xs text-slate-700">نظر
                      شما:</label>
                    <textarea cols="30" rows="5" id="body" name="body"
                      placeholder="با ثبت نظر خود ما را در خدمت رسانی بهتر یاری کنید."
                      class="text-sm block w-full rounded-lg border border-gray-400 bg-white px-3 py-2 font-normal text-gray-700 outline-none focus:border-red-300"></textarea>
                  </div>
                  <button
                    class="inline-block px-8 py-2 ml-auto font-semibold text-center text-white bg-red-500 rounded-lg shadow-md text-xs"
                    id="form-submit" type="submit">ارسال نظر</button>
            </div>
            </form>
            {% else %}
            <a href="{% url 'account:Login-user' %}" class="btn-login-prompt">برای ثبت نظر ابتدا باید وارد شوید</a>
          </div>
          {% endif %}
         </div>
       </div>
      </div>
    </div>
   </div>
 </div>
</div>

  <!-- SLIDER -->
  <div class="bg-white rounded-2xl pt-10">
    <!-- FOOTER -->
    {% include 'includes/footer.html' %}
</body>
<!--DROPDOWNS FOR NAVBAR-->
<script src="https://unpkg.com/@themesberg/flowbite@1.1.1/dist/flowbite.bundle.js"></script>
<script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.js" defer>
</script>
<!--MOBILE NAVBAR-->
<script src="{% static 'js/navbar.js' %}"></script>
<!-- SHOW MODAL SEARCH -->
<script src="{% static 'js/searchBox.js' %}"></script>
<!-- TOAST -->
<script src="{% static 'js/toastify.js' %}"></script>
<!-- PRODUCT SLIDER -->
<script src="{% static 'js/swiper-bundle.min.js' %}"></script>
<script src="{% static 'js/scriptSlider.style.js' %}"></script>
<!-- showImageSingleProduct -->
<script src="{% static 'js/showImageSingleProduct.js' %}"></script>
<!-- TABS -->
<link rel="stylesheet" href="https://unpkg.com/@themesberg/flowbite@1.2.0/dist/flowbite.min.css" />
<script src="https://unpkg.com/@themesberg/flowbite@1.2.0/dist/flowbite.bundle.js"></script>
<!-- INPUTS ADD NUMBER -->
<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  function set_value(id) {
    document.getElementById('parent_id').value = id;
    window.location.href = "#body"
  }
</script>

{% if messages %}
  <script>
    const djangoMessages = [
      {% for message in messages %}
        { icon: "{{ message.tags }}", title: "{{ message }}" },
      {% endfor %}
    ];

    document.addEventListener('DOMContentLoaded', function () {
      if (djangoMessages.length > 0) {
        Swal.fire({
          icon: djangoMessages[0].icon || 'info',
          title: djangoMessages[0].title,
          confirmButtonText: 'تایید',
          confirmButtonColor: '#46A9AE',
          background: '#fff',
          showClass: { popup: 'animate__animated animate__fadeInDown' },
          hideClass: { popup: 'animate__animated animate__fadeOutUp' }
        });
      }
    });
  </script>
{% endif %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector("#comment");

    if (form) {
      form.addEventListener("submit", function (e) {
        e.preventDefault();

        const formData = new FormData(form);

        fetch(form.action || window.location.href, {
          method: "POST",
          headers: {
            "X-Requested-With": "XMLHttpRequest",
          },
          body: formData,
        })
          .then((response) => {
            if (!response.ok) throw new Error("خطا در ارسال نظر");
            return response.text();
          })
          .then(() => {
            Swal.fire({
              title: "نظر شما با موفقیت ثبت شد",
              text: "پس از تأیید در بخش پرسش‌ها نمایش داده می‌شود.",
              icon: "success",
              confirmButtonText: "تأیید",
              confirmButtonColor: "#e74c3c",
              background: "#ffffff",
              showClass: {
                popup: "animate__animated animate__fadeInDown",
              },
              hideClass: {
                popup: "animate__animated animate__fadeOutUp",
              }
            });

            form.reset();
          })
          .catch((error) => {
            Swal.fire({
              title: "خطا",
              text: "ارسال نظر با مشکل مواجه شد.",
              icon: "error",
              confirmButtonText: "تأیید",
              confirmButtonColor: "#e74c3c",
            });
            console.error(error);
          });
      });
    }
  });
</script>


</html>